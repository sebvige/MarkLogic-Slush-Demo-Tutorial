angular.module("sample",["ngRoute","ngCkeditor","ui.bootstrap","ngJsonExplorer","ml.common","ml.search","ml.search.tpls","ml.utils","sample.user","sample.search","sample.common","sample.detail","sample.create"]).config(["$routeProvider","$locationProvider","mlMapsProvider",function(e,t,r){"use strict";t.html5Mode(!0),e.when("/",{templateUrl:"/search/search.html",controller:"SearchCtrl",reloadOnSearch:!1}).when("/create",{templateUrl:"/create/create.html",controller:"CreateCtrl"}).when("/detail",{templateUrl:"/detail/detail.html",controller:"DetailCtrl"}).when("/profile",{templateUrl:"/user/profile.html",controller:"ProfileCtrl"}).otherwise({redirectTo:"/"})}]),angular.module("sample.common",[]).filter("object2Array",function(){"use strict";return function(e){var t=[];for(var r in e)e[r].__key=r,t.push(e[r]);return t}}),angular.module("sample.create").directive("compile",function(e){"use strict";return function(t,r,n){t.$watch(function(e){return e.$eval(n.compile)},function(n){r.html(n),e(r.contents())(t)})}}),function(){"use strict";angular.module("sample.create").controller("CreateCtrl",["$scope","MLRest","$window","User",function(e,t,r,n){var a={person:{isActive:!0,balance:0,picture:"http://placehold.it/32x32",age:0,eyeColor:"",name:"",gender:"",company:"",email:"",phone:"",address:"",about:"",registered:"",latitude:0,longitude:0,tags:[],friends:[],greeting:"",favoriteFruit:""},newTag:"",user:n};angular.extend(e,{model:a,editorOptions:{height:"100px",toolbarGroups:[{name:"clipboard",groups:["clipboard","undo"]},{name:"basicstyles",groups:["basicstyles","cleanup"]},{name:"paragraph",groups:["list","indent","blocks","align","bidi"]},{name:"links"}],toolbar:"",toolbar_full:""},submit:function(){t.createDocument(e.model.person,{format:"json",directory:"/content/",extension:".json"}).then(function(e){r.location.href="/detail?uri="+e.headers("location").replace(/(.*\?uri=)/,"")})},addTag:function(){a.person.tags.push(a.newTag),a.newTag=""}})}])}(),angular.module("sample.create",[]),function(){"use strict";angular.module("sample.detail").controller("DetailCtrl",["$scope","MLRest","$routeParams",function(e,t,r){var n=r.uri,a={detail:{}};t.getDocument(n,{format:"json"}).then(function(e){a.detail=e.data}),angular.extend(e,{model:a})}])}(),angular.module("sample.detail",[]),function(){"use strict";angular.module("sample.search").controller("SearchCtrl",["$scope","$location","User","MLSearchFactory","MLRemoteInputService",function(e,t,r,n,a){function o(e){s.search=e,s.qtext=l.getText(),s.page=l.getPage(),a.setInput(s.qtext),t.search(l.getParams())}function u(e){return s.user.authenticated?(arguments.length&&(s.qtext=e),void l.setText(s.qtext).setPage(s.page).search().then(o)):void(s.search={})}var l=n.newContext(),s={page:1,qtext:"",search:{},user:r};!function(){a.initCtrl(e,s,l,u),e.$watch("model.user.authenticated",function(){u()}),l.fromParams().then(function(){l.setText(s.qtext),o({})}),e.$on("$locationChangeSuccess",function(e,t,r){l.locationChange(t,r).then(function(){u()})})}(),angular.extend(e,{model:s,search:u,toggleFacet:function(e,t){l.toggleFacet(e,t).search().then(o)}})}])}(),angular.module("sample.search",[]),function(){"use strict";angular.module("sample.user").controller("ProfileCtrl",["$scope","MLRest","User","$location",function(e,t,r,n){var a={user:r,newEmail:""};angular.extend(e,{model:a,addEmail:function(){e.profileForm.newEmail.$error.email||(e.model.user.emails||(e.model.user.emails=[]),e.model.user.emails.push(a.newEmail),a.newEmail="")},removeEmail:function(t){e.model.user.emails.splice(t,1)},submit:function(){t.updateDocument({user:{fullname:e.model.user.fullname,emails:e.model.user.emails}},{format:"json",uri:"/users/"+e.model.user.name+".json"}).then(function(e){n.path("/")})}})}])}(),function(){"use strict";angular.module("sample.user").directive("mlUser",[function(){return{restrict:"EA",controller:"UserController",replace:!0,scope:{},templateUrl:"/user/user-dir.html"}}]).controller("UserController",["$scope","User",function(e,t){angular.extend(e,{user:t,login:t.login,logout:function(){t.logout(),e.password=""}})}])}(),function(){"use strict";angular.module("sample.user").factory("User",["$http",function(e){function t(){return n.name="",n.password="",n.loginError=!1,n.authenticated=!1,n.hasProfile=!1,n.fullname="",n.emails=[],n}function r(e){var t=e.data;n.authenticated=t.authenticated,n.authenticated&&(n.name=t.username,t.profile&&(n.hasProfile=!0,n.fullname=t.profile.fullname,_.isArray(t.profile.emails)?n.emails=t.profile.emails:n.emails=[t.profile.emails]))}var n={};return t(),e.get("/user/status",{}).then(r),angular.extend(n,{login:function(t,a){e.get("/user/login",{params:{username:t,password:a}}).then(function(e){r(e),n.loginError=!n.authenticated})},logout:function(){e.get("/user/logout").then(t)}}),n}])}(),angular.module("sample.user",["sample.common"]),function(){"use strict";angular.module("sample.common").factory("MLSampleQueryBuilder",[function(){var e=function(){return 1===arguments.length&&angular.isArray(arguments[0])?{"and-query":{queries:arguments[0]}}:{"and-query":{queries:Array.prototype.slice.call(arguments)}}};return{andQuery:e,boostQuery:function(t,r){return t?{"boost-query":{"matching-query":t,"boosting-query":r}}:{"boost-query":{"matching-query":e(),"boosting-query":r}}},collectionConstraintQuery:function(e,t){return{"collection-constraint-query":{"constraint-name":e,uri:Array.isArray(t)?t:[t]}}},customConstraintQuery:function(e,t){return{"custom-constraint-query":{"constraint-name":e,text:t}}},customGeospatialConstraintQuery:function(e,t,r){return{"custom-constraint-query":{"constraint-name":e,annotation:t,box:r}}},documentQuery:function(e){return{"document-query":{uri:Array.isArray(e)?e:[e]}}},geospatialConstraintQuery:function(e,t){return{"geospatial-constraint-query":{"constraint-name":e,box:t}}},operatorState:function(e,t){return{"operator-state":{"operator-name":e,"state-name":t}}},orQuery:function(){return 1===arguments.length&&angular.isArray(arguments[0])?{"or-query":{queries:arguments[0]}}:{"or-query":{queries:Array.prototype.slice.call(arguments)}}},propertiesQuery:function(e){return{"properties-query":e}},rangeConstraintQuery:function(e,t,r,n){return n||(n=[]),t||(t="EQ"),{"range-constraint-query":{"constraint-name":e,"range-operator":t,value:r,"range-option":n}}},structuredQuery:function(){return 1===arguments.length&&angular.isArray(arguments[0])?{query:{queries:arguments[0]}}:{query:{queries:Array.prototype.slice.call(arguments)}}},termQuery:function(e,t){return t?{"term-query":{text:e,weight:t}}:{"term-query":{text:e}}},textQuery:function(e){return{qtext:e}}}}])}();